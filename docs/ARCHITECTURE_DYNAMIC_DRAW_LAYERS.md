# ğŸš€ åŠ¨æ€Drawå±‚æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

å°†drawå±‚æ ¹æ®é€‰ä¸­çš„è™šæ‹Ÿå›¾å±‚ä½ç½®åŠ¨æ€æ‹†åˆ†ä¸ºå¤šä¸ªç‰©ç†drawå±‚ï¼Œå®ç°ç¼–è¾‘é€‰ä¸­å›¾å±‚æ—¶åªé‡ç»˜è¯¥å›¾å±‚ï¼Œè€Œä¸éœ€è¦é‡ç»˜æ‰€æœ‰å›¾å±‚ã€‚

## ğŸ¯ æ€§èƒ½æå‡åˆ†æ

### å½“å‰å®ç°çš„é—®é¢˜

**å½“å‰æ¶æ„ï¼š**
- æ‰€æœ‰è™šæ‹Ÿå›¾å±‚å†…å®¹éƒ½ç»˜åˆ¶åœ¨åŒä¸€ä¸ª `drawå±‚` ä¸Š
- ç¼–è¾‘é€‰ä¸­å›¾å±‚æ—¶ï¼Œè§¦å‘å…¨é‡é‡ç»˜ï¼ˆ`redrawCanvas()`ï¼‰
- éœ€è¦éå†æ‰€æœ‰è™šæ‹Ÿå›¾å±‚ï¼Œå°†æ‰€æœ‰å›¾å±‚çš„ç¼“å­˜ç»˜åˆ¶åˆ°drawå±‚
- å³ä½¿å…¶ä»–å›¾å±‚æ²¡æœ‰å˜åŒ–ï¼Œä¹Ÿéœ€è¦é‡æ–°ç»˜åˆ¶

**æ€§èƒ½ç“¶é¢ˆï¼š**
- å›¾å±‚æ•°é‡å¤šæ—¶ï¼ˆå¦‚20+ï¼‰ï¼Œæ¯æ¬¡ç¼–è¾‘éƒ½éœ€è¦é‡ç»˜æ‰€æœ‰å›¾å±‚
- å³ä½¿ä½¿ç”¨ç¼“å­˜ï¼Œä¹Ÿéœ€è¦å¤šæ¬¡ `drawImage` è°ƒç”¨
- ç¼–è¾‘æ“ä½œé¢‘ç¹æ—¶ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§

### ä¼˜åŒ–æ–¹æ¡ˆ

**æ–°æ¶æ„ï¼š**
- é€‰ä¸­è™šæ‹Ÿå›¾å±‚æ—¶ï¼ŒåŠ¨æ€åˆ›å»ºç‰©ç†drawå±‚
- æ ¹æ®é€‰ä¸­å›¾å±‚çš„ä½ç½®ï¼Œå°†drawå±‚æ‹†åˆ†ä¸ºï¼š
  - **ä¸­é—´ä½ç½®**ï¼šdraw-bottom + draw-selected + draw-top
  - **æœ€ä¸Šå±‚**ï¼šdraw-bottom + draw-selected
  - **æœ€ä¸‹å±‚**ï¼šdraw-selected + draw-top
- ç¼–è¾‘é€‰ä¸­å›¾å±‚æ—¶ï¼Œåªé‡ç»˜ `draw-selected` å±‚

**æ€§èƒ½æå‡ï¼š**
- âœ… **ç¼–è¾‘é€‰ä¸­å›¾å±‚æ—¶**ï¼šåªé‡ç»˜1ä¸ªdrawå±‚ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å›¾å±‚
- âœ… **å…¶ä»–å›¾å±‚ä¿æŒä¸å˜**ï¼šä¸éœ€è¦é‡æ–°ç»˜åˆ¶ï¼Œç›´æ¥ä½¿ç”¨ç°æœ‰Canvaså†…å®¹
- âœ… **å›¾å±‚æ•°é‡å¤šæ—¶**ï¼šæ€§èƒ½æå‡æ›´æ˜æ˜¾ï¼ˆ20ä¸ªå›¾å±‚æ—¶ï¼Œåªéœ€é‡ç»˜1ä¸ªï¼Œè€Œä¸æ˜¯20ä¸ªï¼‰
- âœ… **å‡å°‘drawImageè°ƒç”¨**ï¼šä»Næ¬¡å‡å°‘åˆ°1æ¬¡ï¼ˆNä¸ºå›¾å±‚æ•°é‡ï¼‰

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. åŠ¨æ€Drawå±‚ç»“æ„

```
åœºæ™¯1ï¼šé€‰ä¸­å›¾å±‚åœ¨ä¸­é—´ä½ç½®ï¼ˆzIndex=5ï¼Œå…±10ä¸ªå›¾å±‚ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ interactionå±‚ (z-index: 4)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ draw-top (z-index: 3)                       â”‚ â† ä¸Šå±‚è™šæ‹Ÿå›¾å±‚ï¼ˆzIndex > 5ï¼‰
â”‚   - å›¾å±‚6, 7, 8, 9, 10                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ draw-selected (z-index: 2)                   â”‚ â† é€‰ä¸­çš„è™šæ‹Ÿå›¾å±‚ï¼ˆzIndex=5ï¼‰
â”‚   - å›¾å±‚5ï¼ˆå¯ç¼–è¾‘ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ draw-bottom (z-index: 1)                     â”‚ â† ä¸‹å±‚è™šæ‹Ÿå›¾å±‚ï¼ˆzIndex < 5ï¼‰
â”‚   - å›¾å±‚1, 2, 3, 4                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ backgroundå±‚ (z-index: 0)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯2ï¼šé€‰ä¸­å›¾å±‚åœ¨æœ€ä¸Šå±‚ï¼ˆzIndex=9ï¼Œå…±10ä¸ªå›¾å±‚ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ interactionå±‚ (z-index: 4)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ draw-selected (z-index: 2)                   â”‚ â† é€‰ä¸­çš„è™šæ‹Ÿå›¾å±‚ï¼ˆzIndex=9ï¼‰
â”‚   - å›¾å±‚9ï¼ˆå¯ç¼–è¾‘ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ draw-bottom (z-index: 1)                     â”‚ â† ä¸‹å±‚è™šæ‹Ÿå›¾å±‚ï¼ˆzIndex < 9ï¼‰
â”‚   - å›¾å±‚1-8                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ backgroundå±‚ (z-index: 0)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯3ï¼šé€‰ä¸­å›¾å±‚åœ¨æœ€ä¸‹å±‚ï¼ˆzIndex=0ï¼Œå…±10ä¸ªå›¾å±‚ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ interactionå±‚ (z-index: 4)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ draw-top (z-index: 3)                       â”‚ â† ä¸Šå±‚è™šæ‹Ÿå›¾å±‚ï¼ˆzIndex > 0ï¼‰
â”‚   - å›¾å±‚1-9                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ draw-selected (z-index: 2)                   â”‚ â† é€‰ä¸­çš„è™šæ‹Ÿå›¾å±‚ï¼ˆzIndex=0ï¼‰
â”‚   - å›¾å±‚0ï¼ˆå¯ç¼–è¾‘ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ backgroundå±‚ (z-index: 0)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯4ï¼šæ²¡æœ‰é€‰ä¸­å›¾å±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ interactionå±‚ (z-index: 4)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ drawå±‚ (z-index: 1)                         â”‚ â† æ‰€æœ‰è™šæ‹Ÿå›¾å±‚ï¼ˆç»Ÿä¸€ç»˜åˆ¶ï¼‰
â”‚   - æ‰€æœ‰å›¾å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ backgroundå±‚ (z-index: 0)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒå®ç°é€»è¾‘

#### 2.1 CanvasEngineæ‰©å±•

**æ–°å¢æ–¹æ³•ï¼š**
```typescript
// åˆ›å»ºåŠ¨æ€drawå±‚
createDynamicDrawLayer(layerId: string, zIndex: number): CanvasLayer

// åˆ é™¤åŠ¨æ€drawå±‚
removeDynamicDrawLayer(layerId: string): void

// è·å–é€‰ä¸­å›¾å±‚çš„drawå±‚
getSelectedLayerDrawContext(virtualLayerZIndex: number): CanvasRenderingContext2D

// è·å–ä¸‹å±‚å›¾å±‚çš„drawå±‚
getBottomLayersDrawContext(): CanvasRenderingContext2D

// è·å–ä¸Šå±‚å›¾å±‚çš„drawå±‚
getTopLayersDrawContext(): CanvasRenderingContext2D

// æ‹†åˆ†drawå±‚ï¼ˆæ ¹æ®é€‰ä¸­å›¾å±‚ä½ç½®ï¼‰
splitDrawLayer(selectedLayerZIndex: number, totalLayers: number): {
  hasBottom: boolean;
  hasTop: boolean;
  bottomZIndex: number;
  selectedZIndex: number;
  topZIndex: number;
}
```

#### 2.2 VirtualLayerManageré›†æˆ

**ä¿®æ”¹ `setActiveVirtualLayer()` æ–¹æ³•ï¼š**
```typescript
public setActiveVirtualLayer(layerId: string): boolean {
  const layer = this.getVirtualLayer(layerId);
  if (!layer) return false;

  // æ¸…é™¤ä¹‹å‰çš„åŠ¨æ€drawå±‚
  if (this.activeLayerId && this.activeLayerId !== layerId) {
    this.clearActiveLayerDrawLayers();
  }

  this.activeLayerId = layerId;
  
  // åˆ›å»ºåŠ¨æ€drawå±‚
  if (this.canvasEngine) {
    const allLayers = this.getAllVirtualLayers();
    const selectedZIndex = layer.zIndex;
    const totalLayers = allLayers.length;
    
    // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹†åˆ†drawå±‚
    const needsSplit = this.shouldSplitDrawLayer(selectedZIndex, totalLayers);
    
    if (needsSplit) {
      // æ‹†åˆ†drawå±‚
      this.splitDrawLayersForSelected(selectedZIndex, allLayers);
    } else {
      // ä¸éœ€è¦æ‹†åˆ†ï¼Œä½¿ç”¨ç»Ÿä¸€çš„drawå±‚
      this.mergeDrawLayers();
    }
  }
  
  return true;
}
```

#### 2.3 DrawingHandlerä¼˜åŒ–

**æ–°å¢æ–¹æ³•ï¼š**
```typescript
// åªé‡ç»˜é€‰ä¸­çš„å›¾å±‚
private async redrawSelectedLayerOnly(layerId: string): Promise<void> {
  const layer = this.virtualLayerManager.getVirtualLayer(layerId);
  if (!layer) return;

  // è·å–é€‰ä¸­å›¾å±‚çš„drawå±‚ä¸Šä¸‹æ–‡
  const selectedCtx = this.canvasEngine.getSelectedLayerDrawContext(layer.zIndex);
  if (!selectedCtx) {
    // å¦‚æœæ²¡æœ‰åŠ¨æ€drawå±‚ï¼Œå›é€€åˆ°å…¨é‡é‡ç»˜
    await this.redrawCanvas();
    return;
  }

  // åªæ¸…ç©ºé€‰ä¸­å›¾å±‚çš„drawå±‚
  const canvas = selectedCtx.canvas;
  selectedCtx.clearRect(0, 0, canvas.width, canvas.height);

  // åªç»˜åˆ¶é€‰ä¸­å›¾å±‚çš„å†…å®¹
  const layerActions = layer.actionIds.map(id => 
    this.historyManager.getActionById(id)
  ).filter(Boolean);

  // ä½¿ç”¨ç¼“å­˜æˆ–ç›´æ¥ç»˜åˆ¶
  const cacheCanvas = this.virtualLayerManager.getLayerCache(layer.id);
  if (cacheCanvas && !layer.cacheDirty) {
    selectedCtx.drawImage(cacheCanvas, 0, 0);
  } else {
    // é‡æ–°æ¸²æŸ“åˆ°ç¼“å­˜ï¼Œç„¶åç»˜åˆ¶
    // ... æ¸²æŸ“é€»è¾‘
  }
}
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### åœºæ™¯1ï¼šç¼–è¾‘é€‰ä¸­å›¾å±‚ï¼ˆ20ä¸ªå›¾å±‚ï¼‰

**å½“å‰å®ç°ï¼š**
- éœ€è¦é‡ç»˜ï¼š20ä¸ªå›¾å±‚
- drawImageè°ƒç”¨ï¼š20æ¬¡
- é‡ç»˜æ—¶é—´ï¼š~16msï¼ˆå‡è®¾æ¯ä¸ªå›¾å±‚0.8msï¼‰

**ä¼˜åŒ–åï¼š**
- éœ€è¦é‡ç»˜ï¼š1ä¸ªå›¾å±‚
- drawImageè°ƒç”¨ï¼š1æ¬¡
- é‡ç»˜æ—¶é—´ï¼š~0.8ms

**æ€§èƒ½æå‡ï¼š20å€** âš¡

### åœºæ™¯2ï¼šç¼–è¾‘é€‰ä¸­å›¾å±‚ï¼ˆ50ä¸ªå›¾å±‚ï¼‰

**å½“å‰å®ç°ï¼š**
- éœ€è¦é‡ç»˜ï¼š50ä¸ªå›¾å±‚
- drawImageè°ƒç”¨ï¼š50æ¬¡
- é‡ç»˜æ—¶é—´ï¼š~40ms

**ä¼˜åŒ–åï¼š**
- éœ€è¦é‡ç»˜ï¼š1ä¸ªå›¾å±‚
- drawImageè°ƒç”¨ï¼š1æ¬¡
- é‡ç»˜æ—¶é—´ï¼š~0.8ms

**æ€§èƒ½æå‡ï¼š50å€** âš¡

### åœºæ™¯3ï¼šåˆ‡æ¢é€‰ä¸­å›¾å±‚

**å½“å‰å®ç°ï¼š**
- éœ€è¦é‡ç»˜ï¼šæ‰€æœ‰å›¾å±‚ï¼ˆé‡æ–°ç»˜åˆ¶åˆ°drawå±‚ï¼‰
- æ—¶é—´ï¼šå–å†³äºå›¾å±‚æ•°é‡

**ä¼˜åŒ–åï¼š**
- éœ€è¦æ‹†åˆ†/åˆå¹¶drawå±‚
- éœ€è¦é‡ç»˜ï¼šæ‰€æœ‰å›¾å±‚ï¼ˆä½†åªéœ€è¦ä¸€æ¬¡ï¼Œä¹‹åç¼–è¾‘æ—¶åªéœ€é‡ç»˜é€‰ä¸­å›¾å±‚ï¼‰
- æ—¶é—´ï¼šæ‹†åˆ†æ—¶ç¨æ…¢ï¼Œä½†åç»­ç¼–è¾‘æ›´å¿«

## âš ï¸ å®ç°æ³¨æ„äº‹é¡¹

### 1. å›¾å±‚é¡ºåºå˜åŒ–

å½“å›¾å±‚é¡ºåºå˜åŒ–æ—¶ï¼Œéœ€è¦é‡æ–°æ‹†åˆ†drawå±‚ï¼š
- å¦‚æœé€‰ä¸­çš„å›¾å±‚é¡ºåºå˜åŒ–ï¼Œéœ€è¦é‡æ–°è®¡ç®—ä¸Šä¸‹å±‚
- å¦‚æœéé€‰ä¸­å›¾å±‚é¡ºåºå˜åŒ–ï¼Œåªéœ€è¦æ›´æ–°å¯¹åº”çš„drawå±‚å†…å®¹

### 2. å›¾å±‚å¯è§æ€§/é€æ˜åº¦å˜åŒ–

- å¦‚æœé€‰ä¸­çš„å›¾å±‚å¯è§æ€§/é€æ˜åº¦å˜åŒ–ï¼Œåªéœ€è¦é‡ç»˜é€‰ä¸­çš„drawå±‚
- å¦‚æœéé€‰ä¸­å›¾å±‚å¯è§æ€§/é€æ˜åº¦å˜åŒ–ï¼Œéœ€è¦é‡ç»˜å¯¹åº”çš„drawå±‚ï¼ˆbottomæˆ–topï¼‰

### 3. å–æ¶ˆé€‰ä¸­å›¾å±‚

- åˆ é™¤æ‰€æœ‰åŠ¨æ€drawå±‚
- åˆå¹¶å›ç»Ÿä¸€çš„drawå±‚
- éœ€è¦é‡ç»˜æ‰€æœ‰å›¾å±‚åˆ°ç»Ÿä¸€çš„drawå±‚

### 4. å†…å­˜å¼€é”€

- åŠ¨æ€drawå±‚ä¼šå¢åŠ DOMå…ƒç´ æ•°é‡ï¼ˆæœ€å¤š3ä¸ªdrawå±‚ï¼‰
- ä½†ç›¸æ¯”ä¸ºæ¯ä¸ªè™šæ‹Ÿå›¾å±‚åˆ›å»ºç‹¬ç«‹Canvasï¼Œå†…å­˜å¼€é”€æ›´å°

### 5. å…¼å®¹æ€§

- éœ€è¦ä¿æŒå‘åå…¼å®¹ï¼šæ²¡æœ‰é€‰ä¸­å›¾å±‚æ—¶ï¼Œä½¿ç”¨ç»Ÿä¸€çš„drawå±‚
- éœ€è¦å¤„ç†è¾¹ç•Œæƒ…å†µï¼šåªæœ‰1ä¸ªå›¾å±‚ã€æ‰€æœ‰å›¾å±‚éƒ½ä¸å¯è§ç­‰

## ğŸ¯ å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. âœ… CanvasEngineæ‰©å±•ï¼šåŠ¨æ€drawå±‚åˆ›å»º/åˆ é™¤
2. âœ… VirtualLayerManageré›†æˆï¼šé€‰ä¸­å›¾å±‚æ—¶æ‹†åˆ†drawå±‚
3. âœ… DrawingHandlerä¼˜åŒ–ï¼šåªé‡ç»˜é€‰ä¸­å›¾å±‚

### ä¸­ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–ï¼‰
4. â³ å›¾å±‚é¡ºåºå˜åŒ–æ—¶é‡æ–°æ‹†åˆ†drawå±‚
5. â³ å›¾å±‚å¯è§æ€§/é€æ˜åº¦å˜åŒ–æ—¶ä¼˜åŒ–é‡ç»˜
6. â³ å–æ¶ˆé€‰ä¸­å›¾å±‚æ—¶åˆå¹¶drawå±‚

### ä½ä¼˜å…ˆçº§ï¼ˆå®Œå–„ï¼‰
7. â³ æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡
8. â³ é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### æ€§èƒ½æå‡
- **ç¼–è¾‘é€‰ä¸­å›¾å±‚æ—¶**ï¼šæ€§èƒ½æå‡20-50å€ï¼ˆå–å†³äºå›¾å±‚æ•°é‡ï¼‰
- **å‡å°‘é‡ç»˜å¼€é”€**ï¼šä»é‡ç»˜æ‰€æœ‰å›¾å±‚å‡å°‘åˆ°åªé‡ç»˜1ä¸ªå›¾å±‚
- **å‡å°‘drawImageè°ƒç”¨**ï¼šä»Næ¬¡å‡å°‘åˆ°1æ¬¡

### ç”¨æˆ·ä½“éªŒ
- âœ… ç¼–è¾‘æ“ä½œæ›´æµç•…
- âœ… å“åº”é€Ÿåº¦æ›´å¿«
- âœ… å›¾å±‚æ•°é‡å¤šæ—¶ä¹Ÿèƒ½ä¿æŒè‰¯å¥½æ€§èƒ½

## ğŸ”„ å®æ–½å»ºè®®

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šå®ç°åŸºç¡€åŠŸèƒ½
   - CanvasEngineæ‰©å±•
   - VirtualLayerManageré›†æˆ
   - DrawingHandlerä¼˜åŒ–

2. **ç¬¬äºŒé˜¶æ®µ**ï¼šä¼˜åŒ–å’Œå®Œå–„
   - å¤„ç†å›¾å±‚é¡ºåºå˜åŒ–
   - ä¼˜åŒ–å¯è§æ€§/é€æ˜åº¦å˜åŒ–
   - æ€§èƒ½ç›‘æ§

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šæµ‹è¯•å’Œä¼˜åŒ–
   - æ€§èƒ½æµ‹è¯•
   - è¾¹ç•Œæƒ…å†µæµ‹è¯•
   - å†…å­˜ä½¿ç”¨ç›‘æ§

---

**ç»“è®º**ï¼šè¿™ä¸ªä¼˜åŒ–æ–¹æ¡ˆå¯ä»¥æ˜¾è‘—æå‡ç¼–è¾‘é€‰ä¸­å›¾å±‚æ—¶çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å›¾å±‚æ•°é‡è¾ƒå¤šæ—¶ã€‚å»ºè®®å®æ–½ã€‚

