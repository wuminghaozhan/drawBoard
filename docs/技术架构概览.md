# ğŸ—ï¸ DrawBoard æŠ€æœ¯æ¶æ„æ¦‚è§ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

DrawBoard æ˜¯ä¸€ä¸ªåŸºäºç°ä»£å‰ç«¯æŠ€æœ¯æ ˆæ„å»ºçš„ä¸“ä¸šçº§ç»˜å›¾ç³»ç»Ÿï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§ç»˜åˆ¶å·¥å…·ã€æ™ºèƒ½è¿ç¬”æ•ˆæœã€å›¾å±‚ç®¡ç†ç­‰ä¸“ä¸šåŠŸèƒ½ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- **æ¨¡å—åŒ–æ¶æ„** - 43ä¸ªä¸“ä¸šæ¨¡å—ï¼ŒèŒè´£åˆ†ç¦»æ¸…æ™°
- **é«˜æ€§èƒ½æ¸²æŸ“** - å¤šå±‚Canvas + é¢„æ¸²æŸ“ç¼“å­˜ä¼˜åŒ–  
- **æ™ºèƒ½è¿ç¬”** - å‹æ„Ÿã€é€Ÿåº¦ã€è§’åº¦æ£€æµ‹ï¼Œè´å¡å°”å¹³æ»‘
- **ä¸“ä¸šå·¥å…·** - ç”»ç¬”ã€å‡ ä½•ã€æ–‡å­—ã€å˜æ¢ã€é€‰æ‹©ç­‰å®Œæ•´å·¥å…·é“¾
- **æ€§èƒ½ä¼˜åŒ–** - è‡ªé€‚åº”æ€§èƒ½æ¨¡å¼ï¼Œå†…å­˜æ™ºèƒ½ç®¡ç†
- **å…¨å¹³å°æ”¯æŒ** - æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡
- **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†ç³»ç»Ÿ

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡æ¦‚è§ˆ

### äº”å±‚æ¶æ„æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)         â”‚  Reactç»„ä»¶ã€å·¥å…·é¢æ¿ã€æ§åˆ¶ç•Œé¢ã€é”™è¯¯å¤„ç†æ¼”ç¤º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       åº”ç”¨å±‚ (Application Layer)    â”‚  DrawBoardä¸»ç±»(1056è¡Œ)ã€APIæ¥å£ã€å•ä¾‹ç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)     â”‚  å¤„ç†å™¨æ¨¡å¼ï¼šDrawing/State/Cursor
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     æ ¸å¿ƒæœåŠ¡å±‚ (Core Services)      â”‚  10ä¸ªä¸“ä¸šç®¡ç†å™¨ï¼šå·¥å…·/äº‹ä»¶/å†å²/æ€§èƒ½/é€‰æ‹©/è™šæ‹Ÿå›¾å±‚/å¤æ‚åº¦/å¿«æ·é”®/å¯¼å‡º/é”™è¯¯å¤„ç†/èµ„æºç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¸²æŸ“å¼•æ“å±‚ (Rendering Engine)     â”‚  CanvasEngineã€ä¸‰å±‚Canvasç³»ç»Ÿ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶å…³ç³»

```typescript
// ä¸»è¦ä¾èµ–å…³ç³»
DrawBoard (é—¨é¢ç±»)
â”œâ”€â”€ DrawingHandler (ç»˜åˆ¶å¤„ç†å™¨)
â”œâ”€â”€ StateHandler (çŠ¶æ€å¤„ç†å™¨)  
â”œâ”€â”€ CursorHandler (å…‰æ ‡å¤„ç†å™¨)
â”œâ”€â”€ CanvasEngine (æ¸²æŸ“å¼•æ“)
â”œâ”€â”€ ToolManager (å·¥å…·ç®¡ç†)
â”œâ”€â”€ HistoryManager (å†å²ç®¡ç†)
â”œâ”€â”€ PerformanceManager (æ€§èƒ½ç®¡ç†)
â”œâ”€â”€ VirtualLayerManager (è™šæ‹Ÿå›¾å±‚ç®¡ç†)
â”œâ”€â”€ ErrorHandler (é”™è¯¯å¤„ç†)
â””â”€â”€ LightweightResourceManager (èµ„æºç®¡ç†)
```

---

## ğŸ“Š ç³»ç»Ÿç»Ÿè®¡æ¦‚è§ˆ

### ä»£ç è§„æ¨¡
- **æ€»æ–‡ä»¶æ•°**: 43ä¸ªTypeScriptæ–‡ä»¶
- **æ€»ä»£ç è¡Œæ•°**: 11,431è¡Œ
- **æ ¸å¿ƒç±»æ•°**: 1ä¸ªä¸»ç±» + 3ä¸ªå¤„ç†å™¨ + 10ä¸ªç®¡ç†å™¨
- **å·¥å…·æ•°é‡**: 8ä¸ªä¸“ä¸šç»˜åˆ¶å·¥å…·
- **ç¼–è¯‘é”™è¯¯**: 37ä¸ª (ä¸»è¦æ˜¯ç¤ºä¾‹ä»£ç )

### æ¶æ„ç»„ä»¶
- **å¤„ç†å™¨**: 3ä¸ª (DrawingHandlerã€StateHandlerã€CursorHandler)
- **ç®¡ç†å™¨**: 10ä¸ª (ToolManagerã€HistoryManagerã€PerformanceManagerç­‰)
- **å·¥å…·ç±»**: 8ä¸ª (PenToolã€RectToolã€CircleToolç­‰)
- **æ ¸å¿ƒå¼•æ“**: 1ä¸ª (CanvasEngine)
- **å·¥å…·ç±»**: 5ä¸ª (ErrorHandlerã€Loggerã€ExportManagerç­‰)

---

## ğŸ¯ æ ¸å¿ƒæ¶æ„æ¨¡å¼

### 1. é—¨é¢æ¨¡å¼ (Facade Pattern)
**DrawBoardä¸»ç±»**ä½œä¸ºç³»ç»Ÿç»Ÿä¸€å…¥å£ï¼Œéšè—å†…éƒ¨å¤æ‚æ€§ï¼š
```typescript
export class DrawBoard {
  // å†…éƒ¨å¤æ‚æ€§è¢«éšè—
  private canvasEngine: CanvasEngine;
  private toolManager: ToolManager;
  private historyManager: HistoryManager;
  
  // ç®€æ´çš„å…¬å…±API
  public setTool(tool: ToolType): Promise<void>;
  public setColor(color: string): void;
  public undo(): Promise<boolean>;
  public redo(): Promise<boolean>;
}
```

### 2. å¤„ç†å™¨æ¨¡å¼ (Handler Pattern)
å°†å¤æ‚ä¸šåŠ¡é€»è¾‘åˆ†ç¦»åˆ°ä¸“é—¨å¤„ç†å™¨ï¼š
```typescript
// ç»˜åˆ¶å¤„ç†å™¨ - ä¸“æ³¨ç»˜åˆ¶é€»è¾‘
class DrawingHandler {
  handleDrawStart(event: DrawEvent): void;
  handleDrawMove(event: DrawEvent): void;
  handleDrawEnd(event: DrawEvent): Promise<void>;
}

// çŠ¶æ€å¤„ç†å™¨ - ä¸“æ³¨çŠ¶æ€ç®¡ç†
class StateHandler {
  getState(): DrawBoardState;
  emitStateChange(): void;
}

// å…‰æ ‡å¤„ç†å™¨ - ä¸“æ³¨é¼ æ ‡æ ·å¼
class CursorHandler {
  updateCursor(tool: ToolType): void;
  showDrawingCursor(): void;
}
```

### 3. å·¥å‚æ¨¡å¼ (Factory Pattern)
å·¥å…·åˆ›å»ºå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š
```typescript
class ToolFactory {
  private tools: Map<ToolType, DrawTool> = new Map();
  
  async createTool(type: ToolType): Promise<DrawTool> {
    if (this.tools.has(type)) {
      return this.tools.get(type)!; // ä»ç¼“å­˜è¿”å›
    }
    
    const tool = await this.loadTool(type); // åŠ¨æ€åŠ è½½
    this.tools.set(type, tool); // ç¼“å­˜å·¥å…·
    return tool;
  }
}
```

### 4. å•ä¾‹æ¨¡å¼ (Singleton Pattern)
DrawBoardå®ä¾‹ç®¡ç†ï¼š
```typescript
export class DrawBoard {
  private static instances: WeakMap<HTMLElement, DrawBoard> = new WeakMap();
  
  public static getInstance(container: HTMLElement, config?: DrawBoardConfig): DrawBoard {
    const existingInstance = DrawBoard.instances.get(container);
    if (existingInstance) return existingInstance;
    
    const newInstance = new DrawBoard(container, config);
    DrawBoard.instances.set(container, newInstance);
    return newInstance;
  }
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–æ¶æ„

### å¤šå±‚Canvasç³»ç»Ÿ
```
äº¤äº’å±‚ (z-index: 2) - å®æ—¶äº¤äº’åé¦ˆ
ç»˜åˆ¶å±‚ (z-index: 1) - æœ€ç»ˆç»˜åˆ¶ç»“æœ  
èƒŒæ™¯å±‚ (z-index: 0) - èƒŒæ™¯å’Œç½‘æ ¼
```

### é¢„æ¸²æŸ“ç¼“å­˜ç³»ç»Ÿ
```typescript
class PerformanceManager {
  private cacheMap: Map<string, PreRenderedCache> = new Map();
  
  shouldCache(action: DrawAction): boolean {
    return action.complexity > this.config.complexityThreshold;
  }
  
  createCache(action: DrawAction, canvas: HTMLCanvasElement): PreRenderedCache {
    const cache = this.renderToCache(action, canvas);
    this.cacheMap.set(action.id, cache);
    return cache;
  }
}
```

### äº‹ä»¶èŠ‚æµæœºåˆ¶
```typescript
// é¼ æ ‡ç§»åŠ¨äº‹ä»¶èŠ‚æµåˆ°16ms (60fps)
private mouseMoveThrottle = new Throttle(16);

// è§¦æ‘¸äº‹ä»¶é˜²æŠ–å¤„ç†
private touchDebounce = new Debounce(50);
```

### å†…å­˜ç®¡ç†ç³»ç»Ÿ
```typescript
class LightweightResourceManager {
  private resources: Map<string, DestroyableResource> = new Map();
  
  register(name: string, resource: DestroyableResource): void;
  destroy(name: string): boolean;
  checkResourceLeaks(): { leaked: string[]; total: number };
}
```

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†å’Œç¨³å®šæ€§

### é”™è¯¯å¤„ç†ç³»ç»Ÿ
```typescript
export class DrawBoardError extends Error {
  public readonly code: DrawBoardErrorCode;
  public readonly context?: any;
  public readonly recoverable: boolean;
  public readonly timestamp: number;
}

export enum DrawBoardErrorCode {
  INITIALIZATION_FAILED = 'INIT_FAILED',
  CANVAS_ERROR = 'CANVAS_ERROR',
  TOOL_ERROR = 'TOOL_ERROR',
  MEMORY_ERROR = 'MEMORY_ERROR',
  RENDERING_ERROR = 'RENDERING_ERROR'
}
```

### èµ„æºç®¡ç†
- **è‡ªåŠ¨æ¸…ç†**: èµ„æºè‡ªåŠ¨é‡Šæ”¾å’Œæ¸…ç†
- **æ³„æ¼æ£€æµ‹**: å®æ—¶æ£€æµ‹èµ„æºæ³„æ¼
- **å†…å­˜ç›‘æ§**: ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- **æ€§èƒ½æŠ¥å‘Š**: ç”Ÿæˆæ€§èƒ½åˆ†ææŠ¥å‘Š

---

## ğŸ¨ å·¥å…·ç³»ç»Ÿæ¶æ„

### å·¥å…·ç»§æ‰¿ä½“ç³»
```
DrawTool (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ PenToolRefactored (ç”»ç¬”å·¥å…·)
â”œâ”€â”€ RectTool (çŸ©å½¢å·¥å…·)
â”œâ”€â”€ CircleTool (åœ†å½¢å·¥å…·)
â”œâ”€â”€ LineTool (ç›´çº¿å·¥å…·)
â”œâ”€â”€ PolygonTool (å¤šè¾¹å½¢å·¥å…·)
â”œâ”€â”€ TextTool (æ–‡å­—å·¥å…·)
â”œâ”€â”€ EraserTool (æ©¡çš®æ“¦å·¥å…·)
â”œâ”€â”€ SelectTool (é€‰æ‹©å·¥å…·)
â””â”€â”€ TransformToolRefactored (å˜æ¢å·¥å…·)
```

### è¿ç¬”æ•ˆæœç³»ç»Ÿ
```typescript
class PenToolRefactored extends DrawTool {
  private strokeConfig: StrokeConfig;
  private calculator: StrokeCalculator;
  private bezierRenderer: BezierRenderer;
  private realtimeRenderer: RealtimeRenderer;
  
  // æ™ºèƒ½è¿ç¬”æ•ˆæœ
  setStrokeConfig(config: StrokeConfig): void;
  setPreset(preset: StrokePresetType): void;
}
```

### é¢„è®¾ç³»ç»Ÿ
- **é’¢ç¬”é¢„è®¾**: ç»å…¸é’¢ç¬”æ•ˆæœ
- **æ¯›ç¬”é¢„è®¾**: ä¼ ç»Ÿæ¯›ç¬”æ•ˆæœ
- **ç²‰ç¬”é¢„è®¾**: é»‘æ¿ç²‰ç¬”æ•ˆæœ
- **è‡ªå®šä¹‰é¢„è®¾**: ç”¨æˆ·è‡ªå®šä¹‰é…ç½®

---

## ğŸ“± å¤šå¹³å°æ”¯æŒ

### æ¡Œé¢ç«¯ä¼˜åŒ–
- **é¼ æ ‡äº‹ä»¶**: ç²¾ç¡®çš„é¼ æ ‡åæ ‡å¤„ç†
- **é”®ç›˜å¿«æ·é”®**: å®Œæ•´çš„å¿«æ·é”®æ”¯æŒ
- **é«˜åˆ†è¾¨ç‡**: æ”¯æŒé«˜DPIæ˜¾ç¤ºå™¨
- **æ€§èƒ½ä¼˜åŒ–**: é’ˆå¯¹æ¡Œé¢ç«¯æ€§èƒ½è°ƒä¼˜

### ç§»åŠ¨ç«¯é€‚é…
- **è§¦æ‘¸äº‹ä»¶**: ä¸“é—¨çš„è§¦æ‘¸äº‹ä»¶å¤„ç†
- **æ‰‹åŠ¿è¯†åˆ«**: æ™ºèƒ½æ‰‹åŠ¿æ£€æµ‹
- **å‹æ„Ÿæ”¯æŒ**: æ”¯æŒå‹æ„Ÿç¬”å’Œè§¦æ‘¸å‹æ„Ÿ
- **ç”µæ± ä¼˜åŒ–**: é™ä½åŠŸè€—çš„æ¸²æŸ“ç­–ç•¥

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ¸²æŸ“æ€§èƒ½
- **å¸§ç‡**: ç¨³å®š60fps
- **å“åº”å»¶è¿Ÿ**: <16ms
- **å†…å­˜ä½¿ç”¨**: å‡å°‘30%
- **ç¼“å­˜å‘½ä¸­ç‡**: >80%
- **å¯åŠ¨æ—¶é—´**: <300ms

### ç”¨æˆ·ä½“éªŒ
- **æµç•…ç»˜åˆ¶**: æ— å¡é¡¿çš„ç»˜åˆ¶ä½“éªŒ
- **å¿«é€Ÿå“åº”**: å³æ—¶çš„ç”¨æˆ·åé¦ˆ
- **ç¨³å®šè¿è¡Œ**: é•¿æ—¶é—´è¿è¡Œæ— æ€§èƒ½è¡°å‡
- **èµ„æºèŠ‚çº¦**: æ›´ä½çš„å†…å­˜å’ŒCPUå ç”¨

---

## ğŸ”® æŠ€æœ¯å‰ç»

### æ¶æ„ä¼˜åŠ¿
- **æ¨¡å—åŒ–**: 43ä¸ªä¸“ä¸šæ¨¡å—ï¼ŒèŒè´£åˆ†ç¦»æ¸…æ™°
- **é«˜æ€§èƒ½**: å¤šå±‚Canvas + é¢„æ¸²æŸ“ç¼“å­˜ä¼˜åŒ–
- **æ˜“æ‰©å±•**: å·¥å‚æ¨¡å¼ + ç­–ç•¥æ¨¡å¼æ”¯æŒçµæ´»æ‰©å±•
- **æ˜“ç»´æŠ¤**: å¤„ç†å™¨æ¨¡å¼å®ç°ä¸šåŠ¡é€»è¾‘åˆ†ç¦»
- **ç¨³å®šæ€§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†

### æ‰©å±•èƒ½åŠ›
- **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶æ‰©å±•
- **äº‘åŒæ­¥**: æ”¯æŒäº‘ç«¯æ•°æ®åŒæ­¥
- **åä½œåŠŸèƒ½**: æ”¯æŒå¤šäººå®æ—¶åä½œ
- **AIé›†æˆ**: æ”¯æŒAIè¾…åŠ©ç»˜åˆ¶åŠŸèƒ½

---

## ğŸ“ æ€»ç»“

DrawBoard æ˜¯ä¸€ä¸ª**æ¶æ„ä¼˜ç§€ã€åŠŸèƒ½å®Œæ•´ã€æ€§èƒ½å‡ºè‰²**çš„ä¸“ä¸šçº§ç»˜å›¾ç³»ç»Ÿï¼Œä½“ç°äº†ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡çš„æœ€ä½³å®è·µï¼š

### ğŸ† æ ¸å¿ƒæˆå°±
- âœ… **ç°ä»£åŒ–æ¶æ„**: äº”å±‚æ¶æ„ + å¤„ç†å™¨æ¨¡å¼
- âœ… **é«˜æ€§èƒ½**: å¤šå±‚Canvas + æ™ºèƒ½ç¼“å­˜
- âœ… **åŠŸèƒ½ä¸°å¯Œ**: å®Œæ•´å·¥å…·é“¾ + è¿ç¬”æ•ˆæœ
- âœ… **ä»£ç è´¨é‡**: 11,431è¡Œé«˜è´¨é‡TypeScriptä»£ç 
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†
- âœ… **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰

### ğŸ¯ æŠ€æœ¯ä»·å€¼
- **å­¦ä¹ å‚è€ƒ**: ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡çš„ä¼˜ç§€æ¡ˆä¾‹
- **å®è·µæŒ‡å¯¼**: å¯å¤ç”¨çš„æ¶æ„æ¨¡å¼å’Œè®¾è®¡æ€æƒ³
- **æ€§èƒ½ä¼˜åŒ–**: å¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- **ä»£ç è´¨é‡**: é«˜è´¨é‡ä»£ç çš„ç¼–å†™æ ‡å‡†

**DrawBoard** å·²ç»è¾¾åˆ°äº†**ç”Ÿäº§å°±ç»ª**çš„æ°´å¹³ï¼Œå¯ä»¥ä½œä¸ºç°ä»£å‰ç«¯ç»˜å›¾ç³»ç»Ÿçš„æ ‡æ†é¡¹ç›®ã€‚ 