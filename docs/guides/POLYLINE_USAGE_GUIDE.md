# 📐 折线工具使用指南

## 📋 概述

折线工具（Polyline）用于绘制开放的、由多个线段连接而成的图形。与多边形（Polygon）的区别在于：
- **折线**：开放的，不闭合，有明确的起点和终点
- **多边形**：闭合的，首尾相连

## 🎯 基本操作

### 1. 开始绘制

1. **选择折线工具**
   - 点击工具栏中的"折线"按钮（📐）
   - 或使用快捷键 `PL`

2. **添加第一个点**
   - 在画布上点击，添加起点
   - 会显示一个实心圆点标记

3. **添加更多点**
   - 继续点击画布，添加更多顶点
   - 每次点击都会添加一个新点，并形成一条线段
   - 已确定的线段显示为实线
   - 从最后一个点到鼠标位置显示虚线预览

### 2. 完成绘制

有以下几种方式完成折线绘制：

- **双击完成**：双击最后一个点或画布任意位置
- **Enter 键**：按 `Enter` 键完成绘制
- **工具切换**：切换到其他工具时，如果折线已有至少 2 个点，会自动完成并保存

### 3. 取消绘制

- **ESC 键**：按 `ESC` 键取消当前绘制
- **工具切换**：切换到其他工具时，如果折线只有 1 个点，会自动取消

### 4. 删除最后一点

- **Backspace 键**：在绘制过程中按 `Backspace` 键删除最后一个添加的点
- 注意：只在绘制过程中有效，避免与删除选中内容的快捷键冲突

## 🎨 视觉反馈

### 绘制过程中的视觉元素

- **实心圆点**：已确定的顶点
- **虚线预览**：从最后一个点到鼠标位置的预览线
- **实线线段**：已确定的线段

### 预览效果

- 移动鼠标时，会显示从最后一个点到鼠标位置的虚线预览
- 预览线帮助用户确定下一个点的位置

## ✏️ 编辑折线

### 选择折线

1. **切换到选择工具**：点击工具栏中的"选择"按钮（S）
2. **点击折线**：点击已绘制的折线进行选择
3. **框选**：拖拽鼠标框选多个折线

### 编辑顶点

选择折线后，会显示：
- **顶点锚点**：每个顶点都有一个锚点（小方块）
- **中心锚点**：折线的中心点，用于移动整个折线

**移动单个顶点**：
- 拖拽顶点锚点，可以移动该顶点
- 其他顶点保持不变

**移动整个折线**：
- 拖拽中心锚点，可以移动整个折线
- 所有顶点一起移动

### 样式编辑

选择折线后，可以通过选择操作栏编辑：
- **描边颜色**：修改折线的颜色
- **线宽**：调整折线的粗细

注意：折线不支持填充色，因为它是开放的图形。

## ⌨️ 快捷键

| 快捷键 | 功能 |
|--------|------|
| `PL` | 切换到折线工具 |
| `Enter` | 完成折线绘制 |
| `ESC` | 取消折线绘制 |
| `Backspace` | 删除最后一个点（仅在绘制过程中） |

## 💡 使用技巧

### 1. 精确绘制

- 慢慢点击，确保每个点的位置准确
- 可以使用选择工具选择折线后，再精确调整顶点位置

### 2. 多段折线

- 完成一条折线后，可以继续绘制新的折线
- 每条折线都是独立的图形元素

### 3. 工具切换

- 在绘制过程中切换工具时：
  - 如果折线已有至少 2 个点，会自动完成并保存
  - 如果折线只有 1 个点，会自动取消
- 这样可以避免丢失已绘制的内容

### 4. 撤销/重做

- 完成折线后，可以使用 `Ctrl+Z` 撤销
- 使用 `Ctrl+Y` 重做

## 🔧 技术细节

### 数据格式

折线使用 `PolylineAction` 类型：

```typescript
interface PolylineAction extends DrawAction {
  type: 'polyline';
  points: Point[]; // 所有顶点，至少 2 个点
  context: {
    strokeStyle: string; // 描边颜色
    lineWidth: number;    // 线宽
    fillStyle: string;    // 填充色（折线不支持填充）
  };
}
```

### 最小点数

- 折线至少需要 **2 个点**（起点和终点）
- 如果只有 1 个点，无法完成绘制

### 复杂度计算

折线的复杂度评分基于：
- 线宽：`lineWidth * 0.3 + 1`
- 点数：`Math.floor(points.length / 5)`

## ❓ 常见问题

### Q: 为什么折线不支持填充色？

A: 折线是开放的图形，没有封闭的区域，因此不支持填充。如果需要填充，请使用多边形工具。

### Q: 如何绘制闭合的折线？

A: 折线工具不支持闭合。如果需要闭合图形，请使用多边形工具，或者手动将折线的最后一个点放在起点附近。

### Q: 工具切换时折线会丢失吗？

A: 不会。如果折线已有至少 2 个点，切换工具时会自动完成并保存。如果只有 1 个点，会自动取消。

### Q: 如何删除折线上的一个顶点？

A: 目前不支持删除折线上的单个顶点。如果需要修改折线，可以：
1. 删除整个折线
2. 重新绘制
3. 或者选择折线后，拖拽顶点调整位置

## 📚 相关文档

- [折线工具设计文档](../POLYLINE_DESIGN.md)
- [折线工具实现审查](../POLYLINE_REVIEW.md)
- [折线工具切换自动完成审查](../POLYLINE_TOOL_SWITCH_REVIEW.md)
- [选择功能使用指南](./SELECTION_USAGE_GUIDE.md)

---

**最后更新**: 2024-12

